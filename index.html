<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blockly JavaScript Builder</title>

    <!-- Include Blockly from CDN -->
    <script src="https://unpkg.com/blockly/blockly.min.js"></script>

    <style>
        #blocklyDiv {
            height: 480px;
            width: 600px;
            border: solid 1px #ccc;
        }
        #outputCode {
            background: #f4f4f4;
            padding: 10px;
            margin-top: 20px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        button {
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            font-size: 16px;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>

    <h1>Create JavaScript Code Using Blockly</h1>

    <div id="blocklyDiv"></div>

    <button id="generateCodeButton">Generate JavaScript Code</button>
    <button id="runCodeButton">Run JavaScript Code</button>

    <pre id="outputCode"></pre>

    <script>
        // Define the alert block
        Blockly.Blocks['alert'] = {
            init: function() {
                this.appendValueInput('TEXT')
                    .setCheck('String')
                    .appendField('alert');
                this.setPreviousStatement(true);
                this.setNextStatement(true);
                this.setColour(160);
            }
        };

        // JavaScript generator for the alert block
        Blockly.JavaScript['alert'] = function(block) {
            var text = Blockly.JavaScript.valueToCode(block, 'TEXT', Blockly.JavaScript.ORDER_NONE) || "''";
            return `alert(${text});\n`;
        };

        // Define variable blocks (set and get)
        Blockly.Blocks['variables_set'] = {
            init: function() {
                this.appendValueInput('VALUE')
                    .setCheck(null)
                    .appendField('set')
                    .appendField(new Blockly.FieldVariable('item'), 'VAR')
                    .appendField('to');
                this.setPreviousStatement(true);
                this.setNextStatement(true);
                this.setColour(330);
                this.setTooltip('Sets the value of a variable');
                this.setHelpUrl('');
            }
        };

        Blockly.JavaScript['variables_set'] = function(block) {
            var variable = Blockly.JavaScript.nameDB_.getName(block.getFieldValue('VAR'), Blockly.Variables.NAME_TYPE);
            var value = Blockly.JavaScript.valueToCode(block, 'VALUE', Blockly.JavaScript.ORDER_ASSIGNMENT) || '0';
            return `${variable} = ${value};\n`;
        };

        Blockly.Blocks['variables_get'] = {
            init: function() {
                this.appendDummyInput()
                    .appendField(new Blockly.FieldVariable('item'), 'VAR');
                this.setOutput(true, null);
                this.setColour(330);
                this.setTooltip('Gets the value of a variable');
                this.setHelpUrl('');
            }
        };

        Blockly.JavaScript['variables_get'] = function(block) {
            var variable = Blockly.JavaScript.nameDB_.getName(block.getFieldValue('VAR'), Blockly.Variables.NAME_TYPE);
            return [variable, Blockly.JavaScript.ORDER_ATOMIC];
        };

        // Simple Math Operation Blocks
        Blockly.Blocks['math_addition'] = {
            init: function() {
                this.appendValueInput('A')
                    .setCheck('Number')
                    .appendField('add');
                this.appendValueInput('B')
                    .setCheck('Number')
                    .appendField('to');
                this.setOutput(true, 'Number');
                this.setColour(230);
                this.setTooltip('Adds two numbers');
                this.setHelpUrl('');
            }
        };

        Blockly.JavaScript['math_addition'] = function(block) {
            var a = Blockly.JavaScript.valueToCode(block, 'A', Blockly.JavaScript.ORDER_NONE) || '0';
            var b = Blockly.JavaScript.valueToCode(block, 'B', Blockly.JavaScript.ORDER_NONE) || '0';
            return [`(${a} + ${b})`, Blockly.JavaScript.ORDER_ADDITION];
        };

        // Simple Text Block
        Blockly.Blocks['text_concat'] = {
            init: function() {
                this.appendValueInput('TEXT1')
                    .setCheck('String')
                    .appendField('concatenate');
                this.appendValueInput('TEXT2')
                    .setCheck('String')
                    .appendField('and');
                this.setOutput(true, 'String');
                this.setColour(160);
                this.setTooltip('Concatenate two text values');
                this.setHelpUrl('');
            }
        };

        Blockly.JavaScript['text_concat'] = function(block) {
            var text1 = Blockly.JavaScript.valueToCode(block, 'TEXT1', Blockly.JavaScript.ORDER_NONE) || "''";
            var text2 = Blockly.JavaScript.valueToCode(block, 'TEXT2', Blockly.JavaScript.ORDER_NONE) || "''";
            return [`(${text1} + ${text2})`, Blockly.JavaScript.ORDER_CONCAT];
        };

        // Repeat Loop Block
        Blockly.Blocks['controls_repeat'] = {
            init: function() {
                this.appendValueInput('TIMES')
                    .setCheck('Number')
                    .appendField('repeat');
                this.appendStatementInput('DO')
                    .setCheck(null)
                    .appendField('do');
                this.setColour(120);
                this.setTooltip('Repeat the block a certain number of times');
                this.setHelpUrl('');
            }
        };

        Blockly.JavaScript['controls_repeat'] = function(block) {
            var times = Blockly.JavaScript.valueToCode(block, 'TIMES', Blockly.JavaScript.ORDER_NONE) || '0';
            var statements = Blockly.JavaScript.statementToCode(block, 'DO');
            return `for (let i = 0; i < ${times}; i++) {\n${statements}}\n`;
        };

        // Control Flow Blocks (if-else)
        Blockly.Blocks['controls_if'] = {
            init: function() {
                this.appendValueInput('IF0')
                    .setCheck('Boolean')
                    .appendField('if');
                this.appendStatementInput('DO0')
                    .setCheck(null)
                    .appendField('do');
                this.setColour(210);
                this.setTooltip('If condition is true, do the statements inside');
                this.setHelpUrl('');
            }
        };

        Blockly.JavaScript['controls_if'] = function(block) {
            var value_if0 = Blockly.JavaScript.valueToCode(block, 'IF0', Blockly.JavaScript.ORDER_NONE) || 'false';
            var statements_do0 = Blockly.JavaScript.statementToCode(block, 'DO0');
            return `if (${value_if0}) {\n${statements_do0}}\n`;
        };

        // Comparison Block (for if statements)
        Blockly.Blocks['logic_compare'] = {
            init: function() {
                this.appendValueInput('A')
                    .setCheck('Number')
                    .appendField('compare');
                this.appendValueInput('B')
                    .setCheck('Number')
                    .appendField('to');
                this.appendDummyInput()
                    .appendField(new Blockly.FieldDropdown([
                        ['=', 'EQ'],
                        ['<', 'LT'],
                        ['>', 'GT']
                    ]), 'OPERATOR');
                this.setOutput(true, 'Boolean');
                this.setColour(210);
                this.setTooltip('Compares two values');
                this.setHelpUrl('');
            }
        };

        Blockly.JavaScript['logic_compare'] = function(block) {
            var value_a = Blockly.JavaScript.valueToCode(block, 'A', Blockly.JavaScript.ORDER_NONE) || '0';
            var value_b = Blockly.JavaScript.valueToCode(block, 'B', Blockly.JavaScript.ORDER_NONE) || '0';
            var operator = block.getFieldValue('OPERATOR');
            var operator_map = {
                'EQ': '==',
                'LT': '<',
                'GT': '>'
            };
            var code = `${value_a} ${operator_map[operator]} ${value_b}`;
            return [code, Blockly.JavaScript.ORDER_RELATIONAL];
        };

        // Initialize Blockly workspace
        const workspace = Blockly.inject('blocklyDiv', {
            toolbox: `
                <xml xmlns="https://developers.google.com/blockly/xml">
                    <block type="controls_if"></block>
                    <block type="controls_repeat"></block>
                    <block type="logic_compare"></block>
                    <block type="math_addition"></block>
                    <block type="text_concat"></block>
                    <block type="variables_set"></block>
                    <block type="variables_get"></block>
                    <block type="alert"></block>
                </xml>
            `,
            trashcan: true
        });

        // Function to generate JavaScript code from Blockly workspace
        function generateCode() {
            const code = Blockly.JavaScript.workspaceToCode(workspace);
            document.getElementById('outputCode').textContent = code;
        }

        // Function to run the generated JavaScript code
        function runCode() {
            const code = Blockly.JavaScript.workspaceToCode(workspace);
            try {
                eval(code);
            } catch (e) {
                alert("Error: " + e.message);
            }
        }

        // Event listeners for the buttons
        document.getElementById('generateCodeButton').addEventListener('click', generateCode);
        document.getElementById('runCodeButton').addEventListener('click', runCode);
    </script>

</body>
</html>
